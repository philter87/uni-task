{
  "description": "Query work items using WIQL (Work Item Query Language)",
  "endpoint": "POST https://dev.azure.com/{organization}/{project}/_apis/wit/wiql?api-version=7.1",
  "headers": {
    "Content-Type": "application/json",
    "Authorization": "Basic {base64_encoded_pat}"
  },
  "examples": [
    {
      "scenario": "Get all active user stories",
      "request": {
        "query": "SELECT [System.Id], [System.Title], [System.State], [System.AssignedTo] FROM WorkItems WHERE [System.WorkItemType] = 'User Story' AND [System.State] = 'Active' ORDER BY [Microsoft.VSTS.Common.Priority] ASC, [System.ChangedDate] DESC"
      },
      "response": {
        "queryType": "flat",
        "queryResultType": "workItem",
        "asOf": "2026-02-21T13:00:00.000Z",
        "columns": [
          {
            "referenceName": "System.Id",
            "name": "ID",
            "url": "https://dev.azure.com/{organization}/_apis/wit/fields/System.Id"
          },
          {
            "referenceName": "System.Title",
            "name": "Title",
            "url": "https://dev.azure.com/{organization}/_apis/wit/fields/System.Title"
          },
          {
            "referenceName": "System.State",
            "name": "State",
            "url": "https://dev.azure.com/{organization}/_apis/wit/fields/System.State"
          },
          {
            "referenceName": "System.AssignedTo",
            "name": "Assigned To",
            "url": "https://dev.azure.com/{organization}/_apis/wit/fields/System.AssignedTo"
          }
        ],
        "workItems": [
          {
            "id": 123,
            "url": "https://dev.azure.com/{organization}/_apis/wit/workItems/123"
          },
          {
            "id": 126,
            "url": "https://dev.azure.com/{organization}/_apis/wit/workItems/126"
          },
          {
            "id": 130,
            "url": "https://dev.azure.com/{organization}/_apis/wit/workItems/130"
          }
        ]
      },
      "notes": [
        "WIQL query returns only work item IDs and URLs by default",
        "Use a separate call to get full work item details: GET workitems?ids=123,126,130",
        "The 'columns' array shows which fields were in the SELECT clause",
        "Results are sorted according to ORDER BY clause"
      ]
    },
    {
      "scenario": "Get my assigned work items",
      "request": {
        "query": "SELECT [System.Id], [System.Title], [System.WorkItemType], [System.State] FROM WorkItems WHERE [System.AssignedTo] = @Me AND [System.State] <> 'Closed' AND [System.State] <> 'Removed' ORDER BY [Microsoft.VSTS.Common.Priority] ASC"
      },
      "notes": [
        "@Me macro expands to the current authenticated user",
        "Use <> for 'not equals' comparison",
        "Multiple conditions combined with AND/OR"
      ]
    },
    {
      "scenario": "Get recently changed items",
      "request": {
        "query": "SELECT [System.Id], [System.Title], [System.ChangedDate], [System.ChangedBy] FROM WorkItems WHERE [System.ChangedDate] >= @Today - 7 ORDER BY [System.ChangedDate] DESC"
      },
      "notes": [
        "@Today macro represents today's date",
        "Date arithmetic: @Today - 7 means 7 days ago",
        "Useful for getting activity in the last N days"
      ]
    },
    {
      "scenario": "Get work items in current sprint/iteration",
      "request": {
        "query": "SELECT [System.Id], [System.Title], [System.WorkItemType], [System.State], [Microsoft.VSTS.Scheduling.StoryPoints] FROM WorkItems WHERE [System.IterationPath] = @CurrentIteration('[MyProject]\\MyTeam') ORDER BY [Microsoft.VSTS.Common.BacklogPriority] ASC"
      },
      "notes": [
        "@CurrentIteration macro gets the active iteration for a team",
        "Replace [MyProject]\\MyTeam with your actual project and team names",
        "Useful for sprint planning and tracking"
      ]
    },
    {
      "scenario": "Get bugs with specific tag",
      "request": {
        "query": "SELECT [System.Id], [System.Title], [System.Tags], [Microsoft.VSTS.Common.Priority] FROM WorkItems WHERE [System.WorkItemType] = 'Bug' AND [System.Tags] CONTAINS 'critical' ORDER BY [Microsoft.VSTS.Common.Priority] ASC"
      },
      "notes": [
        "CONTAINS operator checks if tags field includes the specified tag",
        "Tags are case-insensitive",
        "Can search for multiple tags with multiple CONTAINS clauses"
      ]
    },
    {
      "scenario": "Hierarchical query (get user stories and their tasks)",
      "request": {
        "query": "SELECT [System.Id], [System.Title], [System.WorkItemType], [System.State] FROM WorkItemLinks WHERE [Source].[System.WorkItemType] = 'User Story' AND [Target].[System.WorkItemType] = 'Task' AND [System.Links.LinkType] = 'System.LinkTypes.Hierarchy-Forward' ORDER BY [System.Id] MODE (MustContain)"
      },
      "response": {
        "queryType": "tree",
        "queryResultType": "workItemLink",
        "asOf": "2026-02-21T13:30:00.000Z",
        "columns": [],
        "workItemRelations": [
          {
            "target": {
              "id": 123,
              "url": "https://dev.azure.com/{organization}/_apis/wit/workItems/123"
            },
            "source": null,
            "rel": null
          },
          {
            "target": {
              "id": 124,
              "url": "https://dev.azure.com/{organization}/_apis/wit/workItems/124"
            },
            "source": {
              "id": 123,
              "url": "https://dev.azure.com/{organization}/_apis/wit/workItems/123"
            },
            "rel": "System.LinkTypes.Hierarchy-Forward"
          },
          {
            "target": {
              "id": 125,
              "url": "https://dev.azure.com/{organization}/_apis/wit/workItems/125"
            },
            "source": {
              "id": 123,
              "url": "https://dev.azure.com/{organization}/_apis/wit/workItems/123"
            },
            "rel": "System.LinkTypes.Hierarchy-Forward"
          }
        ]
      },
      "notes": [
        "Tree queries use WorkItemLinks instead of WorkItems",
        "Returns relationships between work items, not just individual items",
        "Source is the parent, Target is the child",
        "First result (source=null) is the top-level item",
        "MODE (MustContain) requires source items to have at least one target"
      ]
    },
    {
      "scenario": "Get work items by area path",
      "request": {
        "query": "SELECT [System.Id], [System.Title], [System.WorkItemType], [System.AreaPath] FROM WorkItems WHERE [System.AreaPath] UNDER 'MyProject\\Authentication' ORDER BY [System.CreatedDate] DESC"
      },
      "notes": [
        "UNDER operator includes all child area paths",
        "Use '=' for exact area path match",
        "Use double backslashes in area paths within JSON strings"
      ]
    },
    {
      "scenario": "Complex query with multiple conditions",
      "request": {
        "query": "SELECT [System.Id], [System.Title], [System.State], [System.AssignedTo], [Microsoft.VSTS.Common.Priority] FROM WorkItems WHERE [System.TeamProject] = @Project AND ([System.WorkItemType] = 'Bug' OR [System.WorkItemType] = 'User Story') AND [System.State] IN ('New', 'Active') AND ([Microsoft.VSTS.Common.Priority] = 1 OR [System.Tags] CONTAINS 'urgent') AND [System.CreatedDate] >= @Today - 30 ORDER BY [Microsoft.VSTS.Common.Priority] ASC, [System.CreatedDate] DESC"
      },
      "notes": [
        "@Project macro represents the current project",
        "IN operator checks if field matches any value in a list",
        "Parentheses group conditions for complex logic",
        "Combines multiple conditions with AND/OR operators"
      ]
    }
  ],
  "common_macros": {
    "@Me": "Current authenticated user",
    "@Today": "Today's date (midnight)",
    "@Project": "Current project",
    "@CurrentIteration": "Current sprint/iteration for a team",
    "@StartOfDay": "Start of current day",
    "@StartOfWeek": "Start of current week",
    "@StartOfMonth": "Start of current month",
    "@StartOfYear": "Start of current year"
  },
  "common_operators": {
    "=": "Equals",
    "<>": "Not equals",
    ">": "Greater than",
    ">=": "Greater than or equal",
    "<": "Less than",
    "<=": "Less than or equal",
    "CONTAINS": "String contains (case-insensitive)",
    "IN": "Value in list",
    "UNDER": "Area/Iteration path hierarchy",
    "NOT IN": "Value not in list",
    "EVER": "Field ever had value",
    "NOT CONTAINS": "String doesn't contain",
    "WAS EVER": "Historic value check"
  },
  "workflow": {
    "step1": "Execute WIQL query to get work item IDs",
    "step2": "Extract IDs from the 'workItems' array in response",
    "step3": "Fetch full work item details using: GET /wit/workitems?ids={id1},{id2},{id3}",
    "step4": "Process work items with all their fields and relations"
  },
  "notes": [
    "WIQL queries are case-insensitive for keywords and field names",
    "Always enclose field names in square brackets [System.Title]",
    "String values use single quotes: 'User Story'",
    "Query results are limited to 20,000 work items by default",
    "For large result sets, consider using $top parameter or more specific filters",
    "Queries only return IDs - make a follow-up call to get full work item data",
    "Tree queries (WorkItemLinks) are useful for parent-child relationships"
  ]
}
